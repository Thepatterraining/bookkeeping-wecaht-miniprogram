<view class="container">
  <view class="content">
    <block wx:if="{{tab==='bill'}}">
      <!-- 加载中提示 -->
      <view class="loading-container" wx:if="{{loading}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">加载中...</text>
      </view>

      <block wx:else>
        <!-- 收支总览组件 -->
        <income-expense-summary
          income="{{monthSummary.income}}"
          expense="{{monthSummary.expense}}"
          bindmonthchange="onMonthChange">
        </income-expense-summary>

        <!-- 预算组件 -->
        <budget-card
          totalBudget="{{monthBudget.total}}"
          usedAmount="{{monthBudget.used}}"
          bindsetbudget="onSetBudget">
        </budget-card>

        <!-- 账单列表 -->
        <bill-list ledgerNo="{{ledgerNo}}" id="billList" />
      </block>
    </block>
    <block wx:if="{{tab==='add'}}">
      <add-form ledgerNo="{{ledgerNo}}" />
    </block>
    <block wx:if="{{tab==='stat'}}">
      <navigator url="/pages/statistics/statistics?ledgerNo={{ledgerNo}}">打开统计页</navigator>
    </block>
    <block wx:if="{{tab==='setting'}}">
      <view class="setting-container">
        <view class="setting-header">
          <view class="setting-title">账本设置</view>
        </view>
        <view class="setting-list">
          <navigator url="/pages/memberManagement/index?ledgerNo={{ledgerNo}}" class="setting-item">
            <view class="setting-item-left">
              <text class="setting-icon">👥</text>
              <text class="setting-name">成员管理</text>
            </view>
            <text class="setting-arrow">></text>
          </navigator>
          <view class="setting-item">
            <view class="setting-item-left">
              <text class="setting-icon">🔔</text>
              <text class="setting-name">消息通知</text>
            </view>
            <text class="setting-arrow">></text>
          </view>
          <view class="setting-item">
            <view class="setting-item-left">
              <text class="setting-icon">🔒</text>
              <text class="setting-name">隐私设置</text>
            </view>
            <text class="setting-arrow">></text>
          </view>
          <view class="setting-item">
            <view class="setting-item-left">
              <text class="setting-icon">📝</text>
              <text class="setting-name">编辑账本信息</text>
            </view>
            <text class="setting-arrow">></text>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- 底部导航栏 -->
  <view class="bottom-tabs">
    <view class="bottom-tab {{tab==='bill' ? 'active' : ''}}" data-tab="bill" bindtap="switchTab">
      <image class="tab-icon" src="{{tab==='bill' ? '/assets/icons/bill-active.png' : '/assets/icons/bill.png'}}" mode="aspectFit"></image>
      <view class="tab-name">账单</view>
    </view>
    <view class="bottom-tab {{tab==='add' ? 'active' : ''}}" data-tab="add" bindtap="switchTab">
      <image class="tab-icon tab-add-icon" src="{{tab==='add' ? '/assets/icons/add-active.png' : '/assets/icons/add.png'}}" mode="aspectFit"></image>
      <view class="tab-name">记账</view>
    </view>
    <view class="bottom-tab {{tab==='stat' ? 'active' : ''}}" data-tab="stat" bindtap="switchTab">
      <image class="tab-icon" src="{{tab==='stat' ? '/assets/icons/statistics-active.png' : '/assets/icons/statistics.png'}}" mode="aspectFit"></image>
      <view class="tab-name">统计</view>
    </view>
    <view class="bottom-tab {{tab==='setting' ? 'active' : ''}}" data-tab="setting" bindtap="switchTab">
      <image class="tab-icon" src="{{tab==='setting' ? '/assets/icons/my-active.png' : '/assets/icons/my.png'}}" mode="aspectFit"></image>
      <view class="tab-name">设置</view>
    </view>
    </view>

  <!-- 设置预算弹窗 -->
  <view class="budget-modal" wx:if="{{showBudgetModal}}" catchtouchmove="preventTouchMove">
    <view class="budget-backdrop" bindtap="hideBudgetModal"></view>
    <view class="budget-modal-content">
      <view class="budget-modal-header">
        <text class="budget-modal-title">设置本月预算</text>
        <text class="budget-modal-close" bindtap="hideBudgetModal">×</text>
      </view>
      <view class="budget-modal-body">
        <view class="budget-form-group">
          <text class="budget-form-label">预算金额</text>
          <input class="budget-form-input" type="number" placeholder="请输入预算金额" value="{{newBudgetAmount}}" bindinput="onBudgetAmountInput" />
        </view>
        <button class="budget-submit-btn" bindtap="saveBudget">保存</button>
      </view>
    </view>
  </view>
</view>