<view class="container">
  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view class="tab {{activeTab==='expense'?'active':''}}" data-tab="expense" bindtap="switchTab">æ”¯å‡º</view>
    <view class="tab {{activeTab==='income'?'active':''}}" data-tab="income" bindtap="switchTab">æ”¶å…¥</view>
  </view>

  <!-- åˆ†ç±»åˆ—è¡¨ -->
  <view class="category-list">
    <!-- æ”¯å‡ºåˆ†ç±»åˆ—è¡¨ -->
    <block wx:if="{{activeTab === 'expense'}}">
      <!-- ç©ºçŠ¶æ€æç¤º -->
      <view wx:if="{{categories.expense.length === 0}}" class="empty-state">
        <!-- æç¤ºæ–‡å­— -->
        <text>æš‚æ— æ”¯å‡ºåˆ†ç±»ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ </text>
      </view>
      <!-- éå†æ”¯å‡ºåˆ†ç±» -->
      <view wx:for="{{categories.expense}}" wx:key="id">
        <!-- ä¸€çº§åˆ†ç±» -->
        <view wx:if="{{item.isParent}}" class="category-parent-item" bindtap="toggleCategoryExpand" data-category-no="{{item.categoryNo}}">
          <!-- åˆ†ç±»ä¿¡æ¯ -->
          <view class="category-info">
            <!-- å±•å¼€/æ”¶èµ·ç®­å¤´ï¼ˆå‘ä¸‹è¡¨ç¤ºå±•å¼€ï¼Œå‘å³è¡¨ç¤ºæ”¶èµ·ï¼‰ -->
            <text class="expand-icon {{item.isExpanded ? 'expanded' : ''}}">â–¼</text>
            <!-- åˆ†ç±»å›¾æ ‡ -->
            <text class="category-icon">{{item.icon}}</text>
            <!-- åˆ†ç±»åç§° -->
            <text class="category-name">{{item.name}}</text>
          </view>
          <!-- åˆ†ç±»æ“ä½œæŒ‰é’® -->
          <view class="category-actions" catchtap="{{true}}">
            <!-- æ·»åŠ å­åˆ†ç±»æŒ‰é’®ï¼Œä½¿ç”¨categoryNoä½œä¸ºparentNo -->
            <text class="action-icon add" bindtap="showAddCategoryModal" data-parent-no="{{item.categoryNo}}" data-is-sub="true">â•</text>
            <!-- ç¼–è¾‘æŒ‰é’®ï¼Œä½¿ç”¨item.typeåŠ¨æ€ä¼ é€’ç±»å‹ -->
            <text class="action-icon edit" bindtap="editCategory" data-category-no="{{item.categoryNo}}" data-type="{{item.type}}">âœï¸</text>
            <!-- åˆ é™¤æŒ‰é’®ï¼Œä½¿ç”¨item.typeåŠ¨æ€ä¼ é€’ç±»å‹ -->
            <text class="action-icon delete" bindtap="deleteCategory" data-category-no="{{item.categoryNo}}" data-type="{{item.type}}">ğŸ—‘ï¸</text>
          </view>
        </view>
        <!-- äºŒçº§åˆ†ç±»ï¼ˆåªæœ‰å½“è¯¥äºŒçº§åˆ†ç±»çš„çˆ¶åˆ†ç±»å±•å¼€æ—¶æ‰æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{!item.isParent && item.parentExpanded}}" 
              class="category-sub-item">
          <!-- åˆ†ç±»ä¿¡æ¯ -->
          <view class="category-info">
            <!-- äºŒçº§åˆ†ç±»ç¼©è¿› -->
            <view class="sub-category-indent"></view>
            <!-- åˆ†ç±»å›¾æ ‡ -->
            <text class="category-icon">{{item.icon}}</text>
            <!-- åˆ†ç±»åç§° -->
            <text class="category-name">{{item.name}}</text>
          </view>
          <!-- åˆ†ç±»æ“ä½œæŒ‰é’® -->
          <view class="category-actions">
            <!-- ç¼–è¾‘æŒ‰é’® -->
            <text class="action-icon edit" bindtap="editCategory" data-category-no="{{item.categoryNo}}" data-type="{{item.type}}">âœï¸</text>
            <!-- åˆ é™¤æŒ‰é’®ï¼Œä½¿ç”¨item.typeä¼ é€’ç±»å‹å‚æ•°ï¼ˆexpenseæˆ–incomeï¼‰ï¼Œä½¿ç”¨categoryNo -->
            <text class="action-icon delete" bindtap="deleteCategory" data-category-no="{{item.categoryNo}}" data-type="{{item.type}}">ğŸ—‘ï¸</text>
          </view>
        </view>
      </view>
    </block>

    <!-- æ”¶å…¥åˆ†ç±»åˆ—è¡¨ -->
    <block wx:if="{{activeTab === 'income'}}">
      <!-- ç©ºçŠ¶æ€æç¤º -->
      <view wx:if="{{categories.income.length === 0}}" class="empty-state">
        <!-- æç¤ºæ–‡å­— -->
        <text>æš‚æ— æ”¶å…¥åˆ†ç±»ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ </text>
      </view>
      <!-- éå†æ”¶å…¥åˆ†ç±» -->
      <view wx:for="{{categories.income}}" wx:key="id">
        <!-- ä¸€çº§åˆ†ç±» -->
        <view wx:if="{{item.isParent}}" class="category-parent-item" bindtap="toggleCategoryExpand" data-category-no="{{item.categoryNo}}">
          <!-- åˆ†ç±»ä¿¡æ¯ -->
          <view class="category-info">
            <!-- å±•å¼€/æ”¶èµ·ç®­å¤´ï¼ˆå‘ä¸‹è¡¨ç¤ºå±•å¼€ï¼Œå‘å³è¡¨ç¤ºæ”¶èµ·ï¼‰ -->
            <text class="expand-icon {{item.isExpanded ? 'expanded' : ''}}">â–¼</text>
            <!-- åˆ†ç±»å›¾æ ‡ -->
            <text class="category-icon">{{item.icon}}</text>
            <!-- åˆ†ç±»åç§° -->
            <text class="category-name">{{item.name}}</text>
          </view>
          <!-- åˆ†ç±»æ“ä½œæŒ‰é’® -->
          <view class="category-actions" catchtap="{{true}}">
            <!-- æ·»åŠ å­åˆ†ç±»æŒ‰é’®ï¼Œä½¿ç”¨categoryNoä½œä¸ºparentNo -->
            <text class="action-icon add" bindtap="showAddCategoryModal" data-parent-no="{{item.categoryNo}}" data-is-sub="true">â•</text>
            <!-- ç¼–è¾‘æŒ‰é’®ï¼Œä½¿ç”¨item.typeåŠ¨æ€ä¼ é€’ç±»å‹ -->
            <text class="action-icon edit" bindtap="editCategory" data-category-no="{{item.categoryNo}}" data-type="{{item.type}}">âœï¸</text>
            <!-- åˆ é™¤æŒ‰é’®ï¼Œä½¿ç”¨item.typeåŠ¨æ€ä¼ é€’ç±»å‹ -->
            <text class="action-icon delete" bindtap="deleteCategory" data-category-no="{{item.categoryNo}}" data-type="{{item.type}}">ğŸ—‘ï¸</text>
          </view>
        </view>
        <!-- äºŒçº§åˆ†ç±»ï¼ˆåªæœ‰å½“è¯¥äºŒçº§åˆ†ç±»çš„çˆ¶åˆ†ç±»å±•å¼€æ—¶æ‰æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{!item.isParent && item.parentExpanded}}" 
              class="category-sub-item">
          <!-- åˆ†ç±»ä¿¡æ¯ -->
          <view class="category-info">
            <!-- äºŒçº§åˆ†ç±»ç¼©è¿› -->
            <view class="sub-category-indent"></view>
            <!-- åˆ†ç±»å›¾æ ‡ -->
            <text class="category-icon">{{item.icon}}</text>
            <!-- åˆ†ç±»åç§° -->
            <text class="category-name">{{item.name}}</text>
          </view>
          <!-- åˆ†ç±»æ“ä½œæŒ‰é’® -->
          <view class="category-actions">
            <!-- ç¼–è¾‘æŒ‰é’® -->
            <text class="action-icon edit" bindtap="editCategory" data-category-no="{{item.categoryNo}}" data-type="{{item.type}}">âœï¸</text>
            <!-- åˆ é™¤æŒ‰é’®ï¼Œä½¿ç”¨item.typeä¼ é€’ç±»å‹å‚æ•°ï¼ˆexpenseæˆ–incomeï¼‰ï¼Œä½¿ç”¨categoryNo -->
            <text class="action-icon delete" bindtap="deleteCategory" data-category-no="{{item.categoryNo}}" data-type="{{item.type}}">ğŸ—‘ï¸</text>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- æ·»åŠ ä¸€çº§åˆ†ç±»æŒ‰é’® -->
  <view class="add-category-btn" bindtap="showAddCategoryModal" data-is-sub="false">
    <!-- åŠ å·å›¾æ ‡ -->
    <text class="add-icon">+</text>
    <!-- æŒ‰é’®æ–‡å­— -->
    <text>æ·»åŠ {{activeTab === 'expense' ? 'æ”¯å‡º' : 'æ”¶å…¥'}}ä¸€çº§åˆ†ç±»</text>
  </view>

  <!-- æ·»åŠ åˆ†ç±»å¼¹çª— -->
  <view class="modal" wx:if="{{showAddModal}}" catchtouchmove="preventTouchMove">
    <!-- è’™å±‚èƒŒæ™¯ï¼Œç‚¹å‡»å…³é—­å¼¹çª— -->
    <view class="modal-backdrop" bindtap="hideAddCategoryModal"></view>
    <!-- å¼¹çª—å†…å®¹ -->
    <view class="modal-content">
      <!-- å¼¹çª—å¤´éƒ¨ -->
      <view class="modal-header">
        <!-- å¼¹çª—æ ‡é¢˜ï¼šæ˜¾ç¤ºæ˜¯æ·»åŠ ä¸€çº§è¿˜æ˜¯äºŒçº§åˆ†ç±» -->
        <text class="modal-title">æ·»åŠ {{activeTab === 'expense' ? 'æ”¯å‡º' : 'æ”¶å…¥'}}{{newCategory.isParent ? 'ä¸€çº§' : 'äºŒçº§'}}åˆ†ç±»</text>
        <!-- å…³é—­æŒ‰é’® -->
        <text class="modal-close" bindtap="hideAddCategoryModal">Ã—</text>
      </view>
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">åˆ†ç±»åç§°</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥åˆ†ç±»åç§°" value="{{newCategory.name}}" bindinput="onCategoryNameInput" />
        </view>

        <view class="form-group">
          <text class="form-label">é€‰æ‹©å›¾æ ‡</text>
          <view class="icon-grid">
            <view class="icon-item {{newCategory.icon === icon ? 'selected' : ''}}"
                  wx:for="{{icons}}"
                  wx:for-item="icon"
                  wx:key="*this"
                  bindtap="selectIcon"
                  data-icon="{{icon}}">
              {{icon}}
            </view>
          </view>
        </view>

        <button class="submit-btn" bindtap="addCategory">ç¡®è®¤æ·»åŠ </button>
      </view>
    </view>
  </view>
</view>
