---
ruleType: Model Request
description: 方案设计
globs:
---
### 3. 创建技术设计文档
在用户批准需求和现状分析后，您应基于功能需求和现状梳理制定一份全面的设计文档，并在设计过程中开展必要研究。

- 设计文档需以需求文档(`requirements.md`)和现状分析(`current_state.md`)为基础
    - 模型 **必须** 先阅读`requirements.md`和`current_state.md`并提取关键信息
    - 模型 **必须** 基于现状分析进行补充的代码调研，特别是针对具体设计决策所需的技术细节
    - 模型 **应当** 避免重复`current_state.md`中已经详细分析过的通用架构调研，但 **必须** 深入调研设计实现所需的具体技术组件
- 模型 **必须** 结合现状分析中的约束条件和复用机会进行设计
- 模型 **必须** 基于现状分析中的设计建议进行方案设计
- 模型 **必须** 在设计中明确说明如何处理现状中识别的问题和风险
- 模型 **应当** 尽量遵循当前项目的架构或者编码模式，并且尽可能参考相似的代码功能点进行修改，以保持代码风格和架构的一致性
  **约束条件：**
- 若尚不存在，模型 **必须** 创建文件 `.spec/{feature_name}/design.md`。设计文档 **必须**：
  - 使用read_citadel_doc mcp工具读取 https://km.sankuai.com/collabpage/2720824514 技术方案模版，保持一致格式：
  - 标题级别 **必须** 保持一致
  - 章节标题 **必须** 保持一致
  - 样例文档提示内容与demo内容仅供参考，不需要输出
  - 没有足够信息的章节可保持空白
- 模型 **应当** 优先利用`current_state.md`中的技术调研结果，避免重复研究
- 模型 **必须** 依据功能需求识别需研究的领域
- 模型 **必须** 通过实际代码调研验证设计的可行性和技术细节
- 模型 **不应** 创建单独的研究文件，而应把研究成果直接作为设计与实现计划的上下文
- 模型 **必须** 总结将指导功能设计的关键发现
- 模型 **应当** 引用来源并在对话中提供相关链接
- 模型 **必须** 在 `.spec/{feature_name}/design.md` 生成一份详细的设计文档
- 模型 **必须** 直接将研究发现融入设计过程
- 适当时，模型 **应当** 插入图表或可视化表示（使用 PlantUML 绘制示意图），图表中应该对于**改动点**进行突出展示
- 模型 **必须** 确保设计覆盖在澄清阶段识别的所有功能需求
- 模型 **应当** 突出设计决策及其理由
- 在设计过程中，模型 **可以** 就具体技术决策向用户征询意见
- 每次更新设计文档后，模型 **必须** 询问用户："设计看起来可以吗？如果可以，我们就进入影响范围分析。"
- 若用户提出修改或未明确批准，模型 **必须** 对设计文档进行修改
- 每次设计文档编辑后，模型 **必须** 再次征求用户明确批准
- 模型 **必须** 收到明确批准（如"yes"、"approved"、"looks good"等）后才可进入影响范围分析阶段
- 模型 **必须** 持续进行反馈-修订循环，直至收到明确批准
- 模型 **必须** 在继续下一步前将所有用户反馈纳入设计文档
- 若设计阶段发现需求缺口，模型 **必须** 提议返回需求澄清环节
