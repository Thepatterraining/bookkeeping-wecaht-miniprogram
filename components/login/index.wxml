<view class="login-modal" wx:if="{{show}}">
  <view class="login-container">
    <view class="login-header">
      <view class="login-title">账号登录</view>
      <view class="login-close" bindtap="handleClose">×</view>
    </view>

    <view class="login-content">
      <view class="login-icon">
        <image src="/assets/icons/statistics-active.png" mode="aspectFit"></image>
      </view>

      <!-- 登录方式切换 -->
      <view class="login-tabs">
        <view class="login-tab {{loginType === 'phone' ? 'active' : ''}}" bindtap="switchLoginType" data-type="phone">手机号登录</view>
        <view class="login-tab {{loginType === 'account' ? 'active' : ''}}" bindtap="switchLoginType" data-type="account">账号登录</view>
        <view class="login-tab {{loginType === 'wechat' ? 'active' : ''}}" bindtap="switchLoginType" data-type="wechat">微信登录</view>
      </view>

      <!-- 手机号验证码登录 -->
      <view class="login-form" wx:if="{{loginType === 'phone'}}">
        <view class="form-item">
          <input class="input" type="number" placeholder="请输入手机号" bindinput="onPhoneInput" value="{{phone}}" maxlength="11" />
        </view>
        <view class="form-item code-item">
          <input class="input code-input" type="number" placeholder="请输入验证码" bindinput="onCodeInput" value="{{verifyCode}}" maxlength="6" />
          <button class="code-btn" bindtap="sendVerifyCode" disabled="{{codeSending || countDown > 0}}">
            {{countDown > 0 ? countDown + 's' : '获取验证码'}}
          </button>
        </view>
        <button class="login-button" type="primary" bindtap="phoneLogin" loading="{{loading}}" disabled="{{loading || !phone || !verifyCode}}">
          登录
        </button>
      </view>

      <!-- 账号密码登录 -->
      <view class="login-form" wx:if="{{loginType === 'account'}}">
        <view class="form-item">
          <input class="input" type="text" placeholder="请输入用户名/手机号" bindinput="onUsernameInput" value="{{username}}" />
        </view>
        <view class="form-item">
          <input class="input" password="true" placeholder="请输入密码" bindinput="onPasswordInput" value="{{password}}" />
        </view>
        <button class="login-button" type="primary" bindtap="accountLogin" loading="{{loading}}" disabled="{{loading || !username || !password}}">
          登录
        </button>
      </view>

      <!-- 微信登录 -->
      <view class="login-form" wx:if="{{loginType === 'wechat'}}">
        <!-- 获取用户信息按钮 -->
        <button
          wx:if="{{step === 'userInfo'}}"
          class="login-button"
          type="primary"
          bindtap="getUserProfileInfo"
          loading="{{loading}}"
          disabled="{{loading}}">
          授权用户信息
        </button>

        <!-- 获取手机号按钮 -->
        <button
          wx:if="{{step === 'phoneNumber'}}"
          class="login-button"
          type="primary"
          open-type="getPhoneNumber"
          bindgetphonenumber="getPhoneNumber"
          loading="{{loading}}"
          disabled="{{loading}}">
          授权手机号
        </button>
      </view>
    </view>
  </view>
  <view class="login-mask"></view>
</view>
